# truncate

Remove content from the end of text when it stops meeting specified criteria.

Works backwards from the end to find where content becomes irrelevant, off-topic, or no longer meets the requirements, then truncates at that point.

## Usage

```javascript
import truncate from 'verblets/src/chains/truncate/index.js';

const text = `
Core technical documentation about the API endpoints and authentication.
Detailed examples showing how to integrate with our system.
Implementation notes for advanced users.

Appendix A: Legal disclaimers and terms of service.
Appendix B: Contact information and support details.
Generated by AI assistant on 2024-01-15.
`;

const cutPoint = await truncate(text, 'Keep only technical documentation');
// Returns: 156 (cuts off the appendices and AI footer)

const truncated = text.slice(0, cutPoint);
// Result: Core technical docs + examples + implementation notes (no appendices)
```

## Parameters

- `text` (string) - The text to analyze for truncation
- `instructions` (string) - Criteria for what content should be kept
- `config` (object) - Configuration options
  - `threshold` (number) - Score threshold below which to truncate (default: 6 out of 10)
  - `chunkSize` (number) - Target characters per chunk (default: 1000)
  - Other options passed through to the score chain

## Return Value

Returns a number representing the character index where to truncate the text.

## How It Works

1. **Chunk the text** - Breaks text into ~1000 character chunks at sentence boundaries
2. **Process in reverse** - Starts from the end and works backwards
3. **Score each chunk** - Uses 0-10 scale to evaluate if content should be kept
4. **Find threshold breach** - Stops at first chunk scoring below threshold (default: < 6)
5. **Return cut point** - Returns character index where content stops meeting criteria

## Examples

**Remove off-topic conclusion:**
```javascript
const article = `
Main article about renewable energy trends and market analysis.
Supporting data and expert interviews on solar adoption rates.

In conclusion, this reminds me of my childhood summers.
My grandmother always said renewable energy was important.
I hope you enjoyed reading this article as much as I enjoyed writing it.
`;

const cutPoint = await truncate(article, 'Keep professional energy analysis only');
const result = article.slice(0, cutPoint);
// Removes the personal anecdotes from the conclusion
```

**Remove boilerplate footer:**
```javascript
const email = `
Thank you for your inquiry about our enterprise software solution.
Here are the technical specifications and pricing details you requested.
Our implementation team can schedule a demo next week.

This email was sent automatically by our CRM system.
To unsubscribe, click here. Â© 2024 Company Inc.
`;

const cutPoint = await truncate(email, 'Keep relevant business communication', {
  threshold: 5  // More aggressive truncation
});
const result = email.slice(0, cutPoint);
// Removes the automated footer
```

**Custom threshold:**
```javascript
const cutPoint = await truncate(text, 'Keep core content only', {
  threshold: 7,  // Higher bar (only keep scores 7+ out of 10)
  chunkSize: 500 // Smaller chunks for finer control
});
```

## Key Features

- **Works backwards** - Finds the first irrelevant content from the end
- **Configurable threshold** - Adjust sensitivity (default: score < 6 triggers truncation)
- **Early termination** - Stops scoring once threshold is breached (efficient)
- **Preserves whitespace** - Maintains original text formatting
- **Clear to LLM** - Explicitly tells the model chunks are in reverse order

## Common Use Cases

- **Remove appendices** from technical documents
- **Cut off-topic conclusions** from articles  
- **Strip boilerplate footers** from emails
- **Remove generated metadata** from content
- **Trim tangential content** that drifts from the main topic
- **Clean up AI-generated text** that becomes repetitive or irrelevant

## Usage Pattern

```javascript
// Find where content becomes irrelevant
const cutPoint = await truncate(text, 'Keep only relevant technical content', {
  threshold: 6  // Truncate when score drops below 6/10
});

// Apply the truncation  
const cleaned = text.slice(0, cutPoint);
```